<!-- Page header -->
<app-header [config]="headerConfig"></app-header>

<!-- Content -->
<div class="container-fluid">
    <app-multi-step
          (stepEmitter)="goToStep($event)"
          [step]="step"
          [items]="itemsStep"
          >
    </app-multi-step>
    @switch(step.name) {
        @case('initial_photo') {
            <app-camera 
                (photoSaved)="onPhotoSaved($event)"
                >
            </app-camera>
        }
        @case('final_photo') {
            <app-camera 
                (photoSaved)="onPhotoSaved($event)"
                >
            </app-camera>
        }
        @case('work_detail') {
            <div class="table-responsive">
                <table class="table table-dark table-sm">
                    <thead>
                        <tr class="text-center roboto-medium">
                            <th>#</th>
                            <th>ITEM</th>
                            <th>VALOR</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for(workDetail of work.workDetails; track workDetail.wrkd_uuid) {
                            <tr class="text-center" >
                                <td>{{$index + 1}}</td>
                                <td>{{workDetail.wrkd_name}}</td>
                                @switch (workDetail.dtp?.dtp_cod) {
                                    @case ('string') {
                                        <td>
                                            <input 
                                                type="text" 
                                                pattern="[a-zA-ZáéíóúÁÉÍÓÚñÑ ]{1,35}" 
                                                class="form-control" 
                                                id="wrkd_value" 
                                                maxlength="35"
                                                name="wrkd_value"
                                                [(ngModel)]="workDetail.wrkd_value"
                                                (blur)="onValueChangeInputText($event, workDetail!)">
                                        </td>
                                    }
                                    @case ('boolean') {
                                        <td>
                                            <input 
                                                type="checkbox" 
                                                class="form-control" 
                                                id="wrkd_value" 
                                                name="wrkd_value" 
                                                [checked]="workDetail.wrkd_value === 'true'"
                                                (click)="onValueChangeInputCheck($event, workDetail!)">
                                                <!-- [(ngModel)]="workDetail.wrkd_value" -->
                                        </td>
                                    }
                                    @case ('Integer') {
                                        <input 
                                                type="number" 
                                                pattern="[a-zA-ZáéíóúÁÉÍÓÚñÑ ]{1,35}" 
                                                class="form-control" 
                                                id="wrkd_value" 
                                                maxlength="35"
                                                name="wrkd_value"
                                                [(ngModel)]="workDetail.wrkd_value"
                                                (blur)="onValueChangeInputNumber($event, workDetail!)">
                                    }
                                    @case ('float') {
                                        <input 
                                                type="number" 
                                                pattern="[a-zA-ZáéíóúÁÉÍÓÚñÑ ]{1,35}" 
                                                class="form-control" 
                                                id="wrkd_value" 
                                                maxlength="35"
                                                name="wrkd_value"
                                                [(ngModel)]="workDetail.wrkd_value"
                                                (blur)="onValueChangeInputNumber($event, workDetail!)">
                                    }
                                    @case ('date') {
                                        <td>
                                            <input 
                                                type="date" 
                                                class="form-control" 
                                                name="wrkd_value" 
                                                id="wrkd_value"
                                                [(ngModel)]="workDetail.wrkd_value"
                                                >
                                        </td>
                                    }
                                    @case ('datetime') {
                                        <td>
                                            <input 
                                                type="datetime-local" 
                                                class="form-control" 
                                                name="wrkd_value" 
                                                id="wrkd_value"
                                                [(ngModel)]="workDetail.wrkd_value"
                                                >
                                        </td>
                                    }
                                    @case ('array') {
                                        <td>
                                            <select 
                                                class="form-control" 
                                                name="wrkd_value" 
                                                [(ngModel)]="workDetail.wrkd_value"
                                                (change)="onValueChangeList($event, workDetail!)">
                                                @for(arrayValue of findDetailModelItemArrayValues(workDetail.wrkd_key!); track arrayValue.id) {
                                                    <option [value]="arrayValue.value">
                                                        {{arrayValue.value}}
                                                    </option>
                                                }
                                            </select>
                                        </td>
                                    }
                                    @default {
                                        <div>
                                            No hay tipo de dato.
                                        </div>
                                    }
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <p class="text-center" style="margin-top: 40px;">
                <button type="reset" class="btn btn-raised btn-secondary btn-sm"><i class="fas fa-paint-roller"></i> &nbsp; VOLVER</button>
                &nbsp; &nbsp;
                <button 
                    type="submit" 
                    class="btn btn-raised btn-info btn-sm"
                    [disabled]="isLoading"
                    (click)="closeWork()"
                    >
                    @if(isLoading) {
                        <span class="spinner spinner-sm me-2"></span>
                        <span>Procesando...</span>
                    } @else {
                        <i class="far fa-save"></i> &nbsp; CERRAR TRABAJO
                    }
                </button>
            </p>
        }
    }
</div>